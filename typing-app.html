<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoType - Modern Typing Practice</title>
    <style>
        :root {
            --primary: #00ff95;
            --secondary: #ff00d4;
            --background: #111827;
            --text: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .title {
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .settings {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .settings select, .settings button {
            padding: 0.5rem 1rem;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--text);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings select:hover, .settings button:hover {
            background: var(--primary);
            color: var(--background);
        }

        .typing-area {
            background: rgba(255, 255, 255, 0.05);
            padding: 2rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .text-display {
            font-size: 1.5rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            min-height: 120px;
        }

        .text-display span {
            position: relative;
            transition: color 0.2s ease;
        }

        .text-display span.correct {
            color: var(--primary);
        }

        .text-display span.incorrect {
            color: var(--secondary);
            text-decoration: underline;
        }

        .text-display span.current {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            animation: cursor-blink 1s infinite;
        }

        @keyframes cursor-blink {
            0%, 100% { background: rgba(255, 255, 255, 0.1); }
            50% { background: rgba(255, 255, 255, 0.3); }
        }

        .input-area {
            position: relative;
        }

        .typing-input {
            width: 100%;
            padding: 1rem;
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 0.5rem;
            color: var(--text);
        }

        .typing-input:focus {
            outline: 2px solid var(--primary);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .dashboard {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            padding: 2rem;
            border-radius: 1rem;
            margin-top: 2rem;
        }

        .dashboard.active {
            display: block;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }

        .particle {
            position: absolute;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 50%;
            animation: float 3s ease-in-out infinite;
        }

        .visual-feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            opacity: 0;
            transition: all 0.2s ease;
            pointer-events: none;
            text-shadow: 0 0 10px currentColor;
        }

        .visual-feedback.active {
            opacity: 1;
            transform: translate(-50%, -100%);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .text-display {
                font-size: 1.2rem;
            }
            
            .typing-input {
                font-size: 1rem;
            }
        }

        // Add shake animation
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }
    </style>
</head>
<body>
    <div class="particles"></div>
    <div class="container">
        <header class="header">
            <h1 class="title">NeoType</h1>
            <p>Future of Typing Practice</p>
        </header>

        <div class="settings">
            <select id="duration">
                <option value="0">No time limit</option>
                <option value="15">15 seconds</option>
                <option value="30">30 seconds</option>
                <option value="60">60 seconds</option>
            </select>
            <select id="difficulty">
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
                <option value="expert">Expert</option>
            </select>
            <select id="textType">
                <option value="words">Common Words</option>
                <option value="quotes">Famous Quotes</option>
                <option value="code">Code Snippets</option>
                <option value="pangrams">Pangrams</option>
            </select>
            <button id="startBtn">Start Test</button>
        </div>

        <div class="typing-area">
            <div class="text-display" id="textDisplay"></div>
            <div class="input-area">
                <input type="text" class="typing-input" id="typingInput" placeholder="Start typing here..." autocomplete="off" disabled>
                <div class="visual-feedback" id="visualFeedback"></div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="wpmValue">0</div>
                <div class="stat-label">Words per Minute</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="accuracyValue">0%</div>
                <div class="stat-label">Accuracy</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="timeValue">0s</div>
                <div class="stat-label">Time</div>
            </div>
        </div>

        <div class="dashboard" id="dashboard">
            <h2>Performance History</h2>
            <canvas id="performanceChart"></canvas>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script>
        // Data structures
        const textContent = {
            words: [
                "the quick brown fox jumps over the lazy dog",
                "pack my box with five dozen liquor jugs",
                "how vexingly quick daft zebras jump",
                "she sells seashells by the seashore",
                "peter piper picked a peck of pickled peppers",
                "I scream you scream we all scream for ice cream",
                "a wonderful bird is the pelican",
                "around the rugged rocks the ragged rascal ran",
                "clean clams crammed in clean cans",
                "three free throws for the team"
            ],
            quotes: [
                "To be or not to be, that is the question",
                "All that glitters is not gold",
                "Life is what happens when you're busy making other plans",
                "Be the change you wish to see in the world",
                "I think therefore I am",
                "Ask not what your country can do for you",
                "That's one small step for man one giant leap for mankind",
                "I have a dream that one day",
                "The only thing we have to fear is fear itself",
                "It always seems impossible until it's done"
            ],
            code: [
                "function hello() { console.log('Hello, World!'); }",
                "const sum = (a, b) => a + b;",
                "for (let i = 0; i < array.length; i++) { }",
                "if (condition) { return true; } else { return false; }",
                "class Rectangle { constructor(height, width) { this.height = height; this.width = width; } }",
                "const promise = new Promise((resolve, reject) => { });",
                "try { await asyncFunction(); } catch (error) { console.error(error); }",
                "document.getElementById('myButton').addEventListener('click', handleClick);",
                "const numbers = [1, 2, 3].map(num => num * 2);",
                "import { useState, useEffect } from 'react';"
            ],
            pangrams: [
                "sphinx of black quartz, judge my vow",
                "two driven jocks help fax my big quiz",
                "quick zephyrs blow, vexing daft jim",
                "waltz, nymph, for quick jigs vex bud",
                "the five boxing wizards jump quickly",
                "pack my box with five dozen liquor jugs",
                "how vexingly quick daft zebras jump",
                "bright vixens jump dozy fowl quack",
                "jumping hay ducks vex big quartz flip",
                "fix problem quickly with galvanized jets"
            ]
        };

        // Game state
        let state = {
            currentText: '',
            currentIndex: 0,
            startTime: null,
            endTime: null,
            mistakes: 0,
            isRunning: false,
            timer: null,
            duration: 0,
            performanceHistory: []
        };

        // DOM Elements
        const elements = {
            textDisplay: document.getElementById('textDisplay'),
            typingInput: document.getElementById('typingInput'),
            startBtn: document.getElementById('startBtn'),
            wpmValue: document.getElementById('wpmValue'),
            accuracyValue: document.getElementById('accuracyValue'),
            timeValue: document.getElementById('timeValue'),
            duration: document.getElementById('duration'),
            difficulty: document.getElementById('difficulty'),
            textType: document.getElementById('textType'),
            dashboard: document.getElementById('dashboard'),
            visualFeedback: document.getElementById('visualFeedback')
        };

        // Initialize particles
        function createParticles() {
            const particlesContainer = document.querySelector('.particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 2 + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Initialize performance chart
        let performanceChart;
        function initChart() {
            const ctx = document.createElement('canvas').getContext('2d');
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'WPM',
                        data: [],
                        borderColor: '#00ff95',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            document.getElementById('performanceChart').replaceWith(ctx.canvas);
        }

        // Game functions
        function getRandomText() {
            const type = elements.textType.value;
            const texts = textContent[type];
            return texts[Math.floor(Math.random() * texts.length)];
        }

        function updateDisplay() {
            elements.textDisplay.innerHTML = state.currentText.split('').map((char, index) => {
                let className = '';
                if (index < state.currentIndex) {
                    className = elements.typingInput.value[index] === char ? 'correct' : 'incorrect';
                } else if (index === state.currentIndex) {
                    className = 'current';
                }
                return `<span class="${className}">${char}</span>`;
            }).join('');
        }

        function calculateWPM() {
            if (!state.startTime) return 0;
            const timeElapsed = ((state.endTime || Date.now()) - state.startTime) / 1000 / 60;
            const words = state.currentIndex / 5;
            return Math.round(words / timeElapsed);
        }

        function calculateAccuracy() {
            if (state.currentIndex === 0) return 100;
            return Math.round(((state.currentIndex - state.mistakes) / state.currentIndex) * 100);
        }

        function updateStats() {
            elements.wpmValue.textContent = calculateWPM();
            elements.accuracyValue.textContent = calculateAccuracy() + '%';
            elements.timeValue.textContent = state.duration ? 
                Math.max(0, Math.ceil(state.duration - ((Date.now() - state.startTime) / 1000))) + 's' :
                Math.ceil((Date.now() - state.startTime) / 1000) + 's';
        }

        function showVisualFeedback(isCorrect) {
            elements.visualFeedback.textContent = isCorrect ? '✓' : '✗';
            elements.visualFeedback.style.color = isCorrect ? '#00ff95' : '#ff00d4';
            elements.visualFeedback.classList.add('active');
            setTimeout(() => elements.visualFeedback.classList.remove('active'), 300);
        }

        function startGame() {
            state = {
                currentText: getRandomText(),
                currentIndex: 0,
                startTime: Date.now(),
                endTime: null,
                mistakes: 0,
                isRunning: true,
                timer: null,
                duration: parseInt(elements.duration.value)
            };

            elements.typingInput.value = '';
            elements.typingInput.disabled = false;
            elements.typingInput.focus();
            updateDisplay();

            if (state.duration) {
                state.timer = setTimeout(endGame, state.duration * 1000);
            }

            requestAnimationFrame(function updateLoop() {
                if (state.isRunning) {
                    updateStats();
                    requestAnimationFrame(updateLoop);
                }
            });
        }

        function endGame() {
            state.isRunning = false;
            state.endTime = Date.now();
            elements.typingInput.disabled = true;
            clearTimeout(state.timer);

            const performance = {
                wpm: calculateWPM(),
                accuracy: calculateAccuracy(),
                timestamp: new Date().toLocaleTimeString()
            };
            state.performanceHistory.push(performance);
            updateDashboard();
        }

        function updateDashboard() {
            elements.dashboard.classList.add('active');
            
            // Update chart data
            performanceChart.data.labels = state.performanceHistory.map(p => p.timestamp);
            performanceChart.data.datasets[0].data = state.performanceHistory.map(p => p.wpm);
            performanceChart.update();
        }

        // Event listeners
        elements.typingInput.addEventListener('input', (e) => {
            if (!state.isRunning) return;

            const inputChar = e.target.value[state.currentIndex];
            const expectedChar = state.currentText[state.currentIndex];

            if (inputChar === expectedChar) {
                showVisualFeedback(true);
                state.currentIndex++;
                updateDisplay();
                
                // Smooth auto-scroll if text is long
                const currentSpan = elements.textDisplay.querySelector('.current');
                if (currentSpan) {
                    currentSpan.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }

                // Check if completed
                if (state.currentIndex === state.currentText.length) {
                    endGame();
                }
            } else if (inputChar !== undefined) {
                // Only show error feedback if an actual character was typed
                showVisualFeedback(false);
                state.mistakes++;
                // Prevent input of incorrect character
                e.target.value = e.target.value.slice(0, state.currentIndex);
                
                // Add subtle shake animation to current character
                const currentSpan = elements.textDisplay.querySelector('.current');
                if (currentSpan) {
                    currentSpan.style.animation = 'shake 0.2s ease';
                    setTimeout(() => {
                        currentSpan.style.animation = '';
                    }, 200);
                }
            }
        });

        elements.startBtn.addEventListener('click', startGame);

        // Handle difficulty changes
        elements.difficulty.addEventListener('change', (e) => {
            const difficulty = e.target.value;
            switch(difficulty) {
                case 'easy':
                    state.currentText = textContent.words[Math.floor(Math.random() * textContent.words.length)];
                    break;
                case 'medium':
                    state.currentText = textContent.quotes[Math.floor(Math.random() * textContent.quotes.length)];
                    break;
                case 'hard':
                    state.currentText = textContent.code[Math.floor(Math.random() * textContent.code.length)];
                    break;
                case 'expert':
                    state.currentText = textContent.pangrams[Math.floor(Math.random() * textContent.pangrams.length)];
                    break;
            }
            updateDisplay();
        });

        // Handle text type changes
        elements.textType.addEventListener('change', () => {
            state.currentText = getRandomText();
            updateDisplay();
        });

        // Easter egg: Konami code handler
        let konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;

        document.addEventListener('keydown', (e) => {
            if (e.key === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    // Activate matrix mode
                    document.body.style.animation = 'matrix 2s';
                    setTimeout(() => {
                        document.body.style.animation = '';
                    }, 2000);
                    konamiIndex = 0;
                }
            } else {
                konamiIndex = 0;
            }
        });

        // Initialize
        state = {
            currentText: getRandomText(),
            currentIndex: 0,
            startTime: null,
            endTime: null,
            mistakes: 0,
            isRunning: false,
            timer: null,
            duration: 0,
            performanceHistory: []
        };
        
        createParticles();
        initChart();
        updateDisplay();
        // All the previous code remains the same until the initialization part
        
        // Remove the old initialization and replace with this:
        
        // Initialize the app
        function initializeApp() {
            // Create initial state
            state = {
                currentText: getRandomText(), // Get initial random text
                currentIndex: 0,
                startTime: null,
                endTime: null,
                mistakes: 0,
                isRunning: false,
                timer: null,
                duration: 0,
                performanceHistory: []
            };
            
            // Create visual elements
            createParticles();
            initChart();
            
            // Force an initial text display
            elements.textDisplay.innerHTML = state.currentText.split('').map((char, index) => {
                return `<span>${char}</span>`;
            }).join('');
        }

        // Matrix animation style
        const style = document.createElement('style');
        style.textContent = `
            @keyframes matrix {
                0% { background: var(--background); }
                50% { background: #00ff00; }
                100% { background: var(--background); }
            }
        `;
        document.head.appendChild(style);

        // Call initialization when the page loads
        window.addEventListener('load', initializeApp);
    </script>
    </body>
    </html>